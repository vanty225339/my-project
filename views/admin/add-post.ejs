<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Th√™m b√†i vi·∫øt - Admin</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #eee;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }
        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            box-sizing: border-box;
        }
        .form-group textarea {
            height: 120px;
            resize: vertical;
        }
        .form-group #content {
            height: 300px;
        }
        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 5px rgba(0,123,255,0.3);
        }
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            font-size: 14px;
            margin-right: 10px;
        }
        .btn-primary {
            background-color: #007bff;
            color: white;
        }
        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }
        .btn:hover {
            opacity: 0.8;
        }
        .form-actions {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }
        .required {
            color: #dc3545;
        }
        .help-text {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
        .form-row {
            display: flex;
            gap: 20px;
        }
        .form-row .form-group {
            flex: 1;
        }
        .alert {
            padding: 12px;
            margin-bottom: 20px;
            border-radius: 4px;
        }
        .alert-danger {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .preview-box {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            margin-top: 10px;
            border: 1px solid #dee2e6;
        }
        .char-count {
            font-size: 12px;
            color: #666;
            text-align: right;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Th√™m b√†i vi·∫øt m·ªõi</h1>
            <a href="/admin/posts" class="btn btn-secondary">‚Üê Quay l·∫°i danh s√°ch</a>
        </div>

        <% if (typeof error !== 'undefined') { %>
            <div class="alert alert-danger">
                ‚ùå <%= error %>
            </div>
        <% } %>

        <form method="POST" action="/admin/posts/add" onsubmit="return validateForm()">
            <div class="form-group">
                <label for="title">Ti√™u ƒë·ªÅ b√†i vi·∫øt <span class="required">*</span></label>
                <input type="text" id="title" name="title" required maxlength="255" 
                       value="<%= typeof formData !== 'undefined' ? formData.title || '' : '' %>"
                       onkeyup="updateCharCount('title', 255)">
                <div class="char-count" id="title-count">0/255 k√Ω t·ª±</div>
                <div class="help-text">Ti√™u ƒë·ªÅ ng·∫Øn g·ªçn v√† thu h√∫t</div>
            </div>

            <div class="form-group">
                <label for="excerpt">T√≥m t·∫Øt b√†i vi·∫øt</label>
                <textarea id="excerpt" name="excerpt" maxlength="300" 
                          placeholder="Vi·∫øt t√≥m t·∫Øt ng·∫Øn g·ªçn v·ªÅ n·ªôi dung b√†i vi·∫øt..."
                          onkeyup="updateCharCount('excerpt', 300)"><%= typeof formData !== 'undefined' ? formData.excerpt || '' : '' %></textarea>
                <div class="char-count" id="excerpt-count">0/300 k√Ω t·ª±</div>
                <div class="help-text">T√≥m t·∫Øt n√†y s·∫Ω hi·ªÉn th·ªã trong danh s√°ch b√†i vi·∫øt</div>
            </div>

            <div class="form-group">
                <label for="content">N·ªôi dung b√†i vi·∫øt <span class="required">*</span></label>
                <textarea id="content" name="content" required 
                          placeholder="Vi·∫øt n·ªôi dung chi ti·∫øt c·ªßa b√†i vi·∫øt t·∫°i ƒë√¢y..."
                          onkeyup="updateCharCount('content')"><%= typeof formData !== 'undefined' ? formData.content || '' : '' %></textarea>
                <div class="char-count" id="content-count">0 k√Ω t·ª±</div>
                <div class="help-text">N·ªôi dung chi ti·∫øt c·ªßa b√†i vi·∫øt. H·ªó tr·ª£ vƒÉn b·∫£n thu·∫ßn</div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="status">Tr·∫°ng th√°i</label>
                    <select id="status" name="status">
                        <option value="draft" <%= (typeof formData !== 'undefined' && formData.status === 'draft') ? 'selected' : '' %>>
                            B·∫£n nh√°p
                        </option>
                        <option value="published" <%= (typeof formData !== 'undefined' && formData.status === 'published') || typeof formData === 'undefined' ? 'selected' : '' %>>
                            Xu·∫•t b·∫£n ngay
                        </option>
                    </select>
                    <div class="help-text">Ch·ªçn "B·∫£n nh√°p" ƒë·ªÉ l∆∞u m√† kh√¥ng xu·∫•t b·∫£n</div>
                </div>

                <div class="form-group">
                    <label for="author_info">T√°c gi·∫£</label>
                    <input type="text" id="author_info" value="<%= username || 'Qu·∫£n tr·ªã vi√™n' %>" readonly style="background-color: #f8f9fa;">
                    <div class="help-text">B√†i vi·∫øt s·∫Ω ƒë∆∞·ª£c ƒëƒÉng d∆∞·ªõi t√™n n√†y</div>
                </div>
            </div>

            <!-- Preview Section -->
            <div class="form-group">
                <label>Xem tr∆∞·ªõc</label>
                <div class="preview-box">
                    <h3 id="preview-title">Ti√™u ƒë·ªÅ s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y</h3>
                    <p id="preview-excerpt" style="color: #666; font-style: italic;">T√≥m t·∫Øt s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y</p>
                    <div id="preview-content" style="line-height: 1.6;">N·ªôi dung s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y</div>
                </div>
            </div>

            <div class="form-actions">
                <button type="submit" class="btn btn-primary">üíæ L∆∞u b√†i vi·∫øt</button>
                <a href="/admin/posts" class="btn btn-secondary">‚ùå H·ªßy</a>
            </div>
        </form>
    </div>

    <script>
        function validateForm() {
            const title = document.getElementById('title').value.trim();
            const content = document.getElementById('content').value.trim();

            if (!title) {
                alert('Ti√™u ƒë·ªÅ b√†i vi·∫øt kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng!');
                return false;
            }

            if (!content) {
                alert('N·ªôi dung b√†i vi·∫øt kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng!');
                return false;
            }

            if (title.length > 255) {
                alert('Ti√™u ƒë·ªÅ kh√¥ng ƒë∆∞·ª£c v∆∞·ª£t qu√° 255 k√Ω t·ª±!');
                return false;
            }

            return confirm('B·∫°n c√≥ ch·∫Øc mu·ªën l∆∞u b√†i vi·∫øt n√†y?');
        }

        function updateCharCount(fieldId, maxLength = null) {
            const field = document.getElementById(fieldId);
            const countElement = document.getElementById(fieldId + '-count');
            const length = field.value.length;
            
            if (maxLength) {
                countElement.textContent = `${length}/${maxLength} k√Ω t·ª±`;
                if (length > maxLength * 0.9) {
                    countElement.style.color = '#dc3545';
                } else {
                    countElement.style.color = '#666';
                }
            } else {
                countElement.textContent = `${length} k√Ω t·ª±`;
            }
            
            // Update preview
            updatePreview();
        }

        function updatePreview() {
            const title = document.getElementById('title').value || 'Ti√™u ƒë·ªÅ s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y';
            const excerpt = document.getElementById('excerpt').value || 'T√≥m t·∫Øt s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y';
            const content = document.getElementById('content').value || 'N·ªôi dung s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y';
            
            document.getElementById('preview-title').textContent = title;
            document.getElementById('preview-excerpt').textContent = excerpt;
            document.getElementById('preview-content').textContent = content.substring(0, 500) + (content.length > 500 ? '...' : '');
        }

        // Event listeners for real-time preview
        document.getElementById('title').addEventListener('input', updatePreview);
        document.getElementById('excerpt').addEventListener('input', updatePreview);
        document.getElementById('content').addEventListener('input', updatePreview);

        // Initialize character counts and preview
        document.addEventListener('DOMContentLoaded', function() {
            updateCharCount('title', 255);
            updateCharCount('excerpt', 300);
            updateCharCount('content');
            updatePreview();
        });
    </script>
</body>
</html>